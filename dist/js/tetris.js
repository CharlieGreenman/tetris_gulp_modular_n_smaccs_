function newShape(){var r=Math.floor(Math.random()*shapes.length),e=shapes[r];current=[];for(var n=0;4>n;++n){current[n]=[];for(var a=0;4>a;++a){var t=4*n+a;current[n][a]="undefined"!=typeof e[t]&&e[t]?r+1:0}}currentX=5,currentY=0}function init(){for(var r=0;ROWS>r;++r){board[r]=[];for(var e=0;COLS>e;++e)board[r][e]=0}}function tick(){if(valid(0,1))++currentY;else{if(freeze(),clearLines(),lose)return newGame(),!1;newShape()}}function freeze(){for(var r=0;4>r;++r)for(var e=0;4>e;++e)current[r][e]&&(board[r+currentY][e+currentX]=current[r][e])}function rotate(r){for(var e=[],n=0;4>n;++n){e[n]=[];for(var a=0;4>a;++a)e[n][a]=r[3-a][n]}return e}function clearLines(){for(var r=ROWS-1;r>=0;--r){for(var e=!0,n=0;COLS>n;++n)if(0==board[r][n]){e=!1;break}if(e){document.getElementById("clearsound").play();for(var a=r;a>0;--a)for(var n=0;COLS>n;++n)board[a][n]=board[a-1][n];++r}}}function keyPress(r){switch(r){case"left":valid(-1)&&--currentX;break;case"right":valid(1)&&++currentX;break;case"down":valid(0,1)&&++currentY;break;case"rotate":var e=rotate(current);valid(0,0,e)&&(current=e)}}function valid(r,e,n){r=r||0,e=e||0,r=currentX+r,e=currentY+e,n=n||current;for(var a=0;4>a;++a)for(var t=0;4>t;++t)if(n[a][t]&&("undefined"==typeof board[a+e]||"undefined"==typeof board[a+e][t+r]||board[a+e][t+r]||0>t+r||a+e>=ROWS||t+r>=COLS))return 1==e&&(lose=!0),!1;return!0}function newGame(){clearInterval(interval),init(),newShape(),lose=!1,interval=setInterval(tick,350)}var COLS=10,ROWS=20,board=[],lose,interval,current,currentX,currentY,shapes=[[1,1,1,1],[1,1,1,0,1],[1,1,1,0,0,0,1],[1,1,0,0,1,1],[1,1,0,0,0,1,1],[0,1,1,0,1,1],[0,1,0,0,1,1,1]],colors=["cyan","orange","blue","yellow","red","green","purple"];newGame();